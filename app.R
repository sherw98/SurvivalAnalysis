library(shiny)
library(ggplot2)

################Various Functions###################

####Function to identify baseline for Cox Model####
detectCoxBaseline = function(Outcome){
  if(Outcome == "Ipsilateral Recurrence (IBTR)"){
    HaFu = matrix(c(0.000000000,0.000000000,0.000000000,0.000000000,0.003485205,0.003485205,0.003485205,0.003485205,
                    0.003485205,0.007029210,0.007029210,0.007029210,0.010618713,0.014218370,0.014218370,0.017853756,
                    0.017853756,0.021523030,0.021523030,0.021523030,0.025224352,0.028947082,0.028947082,0.028947082,
                    0.032713694,0.036493948,0.040296535,0.040296535,0.040296535,0.044129417,0.044129417,0.044129417,
                    0.044129417,0.044129417,0.044129417,0.044129417,0.044129417,0.048144069,0.048144069,0.052198160,
                    0.052198160,0.052198160,0.052198160,0.052198160,0.052198160,0.052198160,0.052198160,0.056398170,
                    0.056398170,0.056398170,0.056398170,0.056398170,0.056398170,0.056398170,0.056398170,0.056398170,
                    0.056398170,0.056398170,0.056398170,0.056398170,0.056398170,0.056398170,0.056398170,0.056398170,
                    0.056398170,0.056398170,0.056398170,0.056398170,0.056398170,0.056398170,0.056398170,0.056398170,
                    0.056398170,0.056398170,0.056398170,0.056398170,0.056398170,0.056398170,0.061268691,0.061268691,
                    0.061268691,0.061268691,0.061268691,0.061268691,0.061268691,0.061268691,0.066349512,0.066349512,
                    0.066349512,0.066349512,0.066349512,0.066349512,0.066349512,0.066349512,0.066349512,0.066349512,
                    0.066349512,0.066349512,0.066349512,0.071775689,0.071775689,0.071775689,0.071775689,0.071775689,
                    0.071775689,0.071775689,0.071775689,0.071775689,0.071775689,0.071775689,0.071775689,0.071775689,
                    0.071775689,0.071775689,0.071775689,0.071775689,0.071775689,0.071775689,0.071775689,0.071775689,
                    0.071775689,0.071775689,0.071775689,0.071775689,0.071775689,0.071775689,0.071775689,0.071775689,
                    0.071775689,0.071775689,0.078538635,0.078538635,0.078538635,0.078538635,0.078538635,0.078538635,
                    0.078538635,0.078538635,0.078538635,0.078538635,0.078538635,0.078538635,0.078538635,0.078538635,
                    0.078538635,0.078538635,0.078538635,0.078538635,0.078538635,0.078538635,0.078538635,0.078538635,
                    0.078538635,0.078538635,0.078538635,0.078538635,0.078538635,0.078538635,0.078538635,0.078538635,
                    0.087240848,0.087240848,0.087240848,0.087240848,0.087240848,0.087240848,0.087240848,0.087240848,
                    0.087240848,0.087240848,0.087240848,0.087240848,0.087240848,0.087240848,0.087240848,0.087240848,
                    0.087240848,0.087240848,0.087240848,0.087240848,0.087240848,0.098107753,0.098107753,0.098107753,
                    0.098107753,0.098107753,0.098107753,0.098107753,0.109941162,0.109941162,0.109941162,0.109941162,
                    0.109941162,0.109941162,0.109941162,0.109941162,0.109941162,0.109941162,0.109941162,0.109941162,
                    0.109941162,0.124141709,0.124141709,0.124141709,0.124141709,0.124141709,0.124141709,0.124141709,
                    0.124141709,0.124141709,0.124141709,0.124141709,0.124141709,0.141582156,0.141582156,0.141582156,
                    0.141582156,0.141582156,0.141582156,0.141582156,0.141582156,0.141582156,0.141582156,0.141582156,
                    0.141582156,0.141582156,0.141582156,0.141582156,0.141582156,0.141582156,0.141582156,0.141582156,
                    0.141582156,0.141582156,0.141582156,0.141582156,0.141582156,0.141582156,0.141582156,0.141582156,
                    0.141582156,0.141582156,0.141582156,0.141582156,0.141582156,0.141582156,0.141582156,0.141582156,
                    0.141582156,0.141582156,0.141582156,0.141582156,0.141582156,0.141582156,0.141582156,0.141582156,
                    0.275981667,0.275981667,0.275981667,0.275981667,0.275981667,0.275981667), ncol = 1)
    TiFu = matrix(c(7.10000,10.13333,13.73333,18.43333,22.00000,23.00000,24.13333,26.13333,26.80000,27.70000,28.63333,
                    31.36667,31.90000,32.26667,33.30000,35.60000,36.43333,41.53333,42.43333,42.73333,43.26667,46.70000,
                    46.80000,48.30000,49.96667,50.00000,50.70000,50.73333,51.23333,52.03333,52.60000,53.20000,54.00000,
                    55.76667,58.03333,58.10000,58.86667,59.43333,60.40000,61.40000,62.73333,63.06667,65.23333,65.33333,
                    68.40000,68.76667,68.93333,69.83333,70.60000,71.53333,71.66667,72.73333,73.53333,74.26667,74.43333,
                    75.96667,77.26667,78.43333,78.53333,78.83333,79.13333,79.53333,79.60000,79.83333,79.86667,82.43333,
                    82.46667,82.93333,83.80000,84.36667,84.76667,86.86667,87.90000,88.26667,90.13333,90.60000,92.40000,
                    94.00000,94.10000,96.10000,96.13333,96.53333,96.93333,97.30000,98.06667,100.96667,101.63333,
                    101.66667,102.16667,102.30000,102.60000,102.70000,102.93333,103.33333,103.46667,103.76667,
                    103.80000,103.83333,103.90000,104.33333,104.36667,104.43333,105.13333,105.23333,105.83333,
                    106.10000,106.70000,106.73333,106.93333,107.80000,108.06667,108.50000,108.73333,108.76667,
                    109.03333,109.06667,109.30000,109.56667,110.13333,110.16667,110.26667,110.66667,111.03333,
                    111.10000,111.30000,111.46667,111.50000,111.70000,112.00000,112.13333,112.30000,112.40000,
                    112.50000,112.90000,113.10000,113.13333,113.20000,113.30000,113.33333,113.66667,114.23333,
                    114.26667,114.90000,115.10000,115.50000,115.90000,116.00000,116.20000,116.30000,116.56667,
                    117.10000,117.26667,118.13333,119.20000,119.73333,121.03333,121.26667,121.86667,121.90000,
                    122.56667,122.90000,123.10000,123.76667,123.80000,124.16667,124.46667,125.33333,126.33333,
                    127.23333,127.63333,128.36667,128.43333,129.30000,129.40000,130.03333,130.30000,130.33333,
                    130.56667,132.70000,132.80000,132.90000,133.06667,133.36667,133.76667,134.13333,135.46667,
                    136.03333,136.06667,136.16667,136.36667,136.40000,136.50000,136.66667,137.10000,138.06667,
                    138.23333,138.36667,138.40000,138.50000,138.90000,140.90000,141.76667,142.33333,142.60000,
                    142.76667,142.93333,143.70000,144.06667,144.33333,145.46667,145.83333,145.86667,146.33333,
                    147.46667,147.86667,148.06667,148.66667,149.03333,149.10000,150.23000,151.06667,151.10000,
                    151.60000,152.46667,153.56667,154.00000,154.33333,154.40000,154.63333,155.86667,156.83333,
                    157.30000,157.53333,159.43333,159.70000,160.23333,161.56667,162.23333,162.86667,163.20000,
                    163.43333,164.20000,164.93333,166.86667,167.26667,167.50000,168.60000,170.90000,171.33333,
                    172.46667,172.73333,173.83333,175.30000,175.73333,178.30000,184.03333,188.30000,189.83333,
                    191.40000,204.20000,221.03333,223.16667), ncol = 1)
  }
  else if(Outcome == "Distant Recurrence (DR)"){
    HaFu = matrix(c(0.003165596,0.003165596,0.006400130,0.009648829,0.009648829,0.012925764,0.016216768,0.016216768,
                    0.019529329,0.019529329,0.022882433,0.022882433,0.026287708,0.029710621,0.029710621,0.033159934,
                    0.033159934,0.036664478,0.040185118,0.043722545,0.043722545,0.047299419,0.050912389,0.054533595,
                    0.054533595,0.058171387,0.061817530,0.061817530,0.065483957,0.069166072,0.069166072,0.072905201,
                    0.072905201,0.072905201,0.076721842,0.080558220,0.084436152,0.088333799,0.088333799,0.092260044,
                    0.092260044,0.096234943,0.096234943,0.100229836,0.104264834,0.104264834,0.104264834,0.108354366,
                    0.108354366,0.108354366,0.112484792,0.112484792,0.112484792,0.112484792,0.112484792,0.116710965,
                    0.120982049,0.120982049,0.125299416,0.125299416,0.125299416,0.129685548,0.134096918,0.138520574,
                    0.138520574,0.138520574,0.138520574,0.143015473,0.143015473,0.143015473,0.143015473,0.143015473,
                    0.147613847,0.147613847,0.152265034,0.152265034,0.157000718,0.157000718,0.157000718,0.161791326,
                    0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,
                    0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,
                    0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,
                    0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,
                    0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,
                    0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,
                    0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,
                    0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,
                    0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,0.161791326,
                    0.170049988,0.170049988,0.170049988,0.170049988,0.178540178,0.178540178,0.178540178,0.178540178,
                    0.178540178,0.187318509,0.187318509,0.187318509,0.187318509,0.187318509,0.187318509,0.187318509,
                    0.187318509,0.187318509,0.187318509,0.187318509,0.187318509,0.187318509,0.187318509,0.197291492,
                    0.197291492,0.197291492,0.197291492,0.197291492,0.197291492,0.197291492,0.197291492,0.197291492,
                    0.208320503,0.208320503,0.208320503,0.208320503,0.208320503,0.208320503,0.208320503,0.208320503,
                    0.208320503,0.208320503,0.208320503,0.221358524,0.221358524,0.221358524,0.221358524,0.221358524,
                    0.221358524,0.221358524,0.221358524,0.221358524,0.221358524,0.221358524,0.221358524,0.221358524,
                    0.221358524,0.221358524,0.221358524,0.221358524,0.221358524,0.221358524,0.221358524,0.221358524,
                    0.221358524,0.221358524,0.221358524,0.221358524,0.221358524,0.221358524,0.221358524,0.221358524,
                    0.221358524,0.221358524,0.221358524,0.221358524,0.245477487,0.245477487,0.245477487,0.245477487,
                    0.245477487,0.245477487,0.245477487,0.245477487,0.245477487,0.245477487,0.245477487,0.245477487,
                    0.245477487,0.245477487,0.245477487,0.245477487,0.245477487,0.245477487,0.245477487,0.245477487,
                    0.245477487,0.245477487,0.245477487,0.245477487,0.245477487,0.245477487,0.245477487,0.245477487,
                    0.245477487,0.245477487,0.245477487,0.245477487,0.245477487,0.245477487,0.245477487), ncol = 1)
    
    TiFu = matrix(c(6.466667,  7.100000,  8.133333, 11.366667, 13.733333, 14.266667, 17.433333, 18.433333, 22.800000, 
                    24.133333, 26.000000, 26.133333, 26.700000, 26.833333, 28.633333, 29.000000, 31.366667, 35.966667,
                    38.566667, 41.100000, 42.733333, 43.100000, 45.033333, 46.466667, 46.800000, 47.900000, 47.933333, 
                    48.300000, 48.866667, 50.333333, 50.733333, 53.033333, 53.200000, 54.000000, 54.200000, 54.700000, 
                    54.733333, 55.133333, 55.766667, 56.233333, 58.100000, 61.133333, 65.333333, 65.633333, 67.833333, 
                    68.933333, 70.600000, 71.333333, 71.533333, 71.666667, 71.800000, 72.733333, 73.533333, 74.266667, 
                    74.433333, 74.566667, 76.966667, 78.833333, 78.900000, 79.133333, 79.600000, 81.066667, 81.200000, 
                    81.600000, 82.433333, 82.466667, 82.933333, 83.200000, 83.800000, 84.366667, 84.766667, 86.866667, 
                    87.233333, 88.266667, 89.066667, 90.133333, 91.400000, 92.400000, 94.000000, 95.333333, 96.100000, 
                    96.133333, 96.533333, 96.933333, 97.300000, 98.066667, 98.900000, 99.833333,100.966667,101.666667,
                    102.166667,102.300000,102.600000,102.700000,102.933333,103.333333,103.466667,103.766667,103.800000,
                    103.833333,103.900000,104.366667,104.433333,105.233333,105.833333,106.100000,106.733333,106.933333,
                    107.800000,108.066667,108.500000,108.733333,108.766667,109.033333,109.066667,109.300000,109.566667,
                    110.133333,110.166667,110.266667,110.533333,110.666667,111.033333,111.100000,111.300000,111.466667,
                    111.500000,111.700000,112.000000,112.133333,112.400000,112.500000,112.900000,113.100000,113.133333,
                    113.200000,113.300000,113.333333,113.666667,114.233333,114.266667,114.900000,115.100000,115.500000,
                    115.900000,116.200000,116.300000,116.566667,117.100000,117.266667,118.133333,119.733333,120.666667,
                    121.033333,121.266667,121.900000,122.400000,122.566667,123.100000,123.766667,123.800000,123.833333,
                    124.466667,125.333333,126.333333,127.233333,127.633333,128.100000,128.366667,128.433333,129.300000,
                    129.400000,130.033333,130.300000,130.333333,131.966667,132.700000,132.800000,132.900000,133.366667,
                    133.766667,134.133333,134.433333,134.766667,135.466667,136.366667,136.400000,136.500000,136.666667,
                    138.066667,138.233333,138.366667,138.400000,138.500000,138.900000,139.700000,140.900000,142.333333,
                    142.600000,142.766667,142.933333,143.700000,144.066667,144.200000,144.333333,145.466667,145.833333,
                    146.333333,147.433333,147.866667,147.900000,148.066667,148.666667,148.766667,149.033333,149.100000,
                    150.230000,151.066667,151.100000,151.600000,152.466667,153.566667,154.000000,154.333333,154.400000,
                    154.466667,155.866667,156.833333,157.166667,157.300000,157.533333,158.033333,159.433333,159.700000,
                    160.200000,160.233333,161.566667,162.233333,162.866667,163.200000,164.000000,164.200000,164.933333,
                    166.866667,167.266667,167.500000,168.600000,170.900000,171.333333,172.466667,172.733333,173.833333,
                    175.300000,175.733333,178.300000,184.033333,188.300000,189.833333,190.300000,191.400000,204.200000,
                    221.033333,223.166667), ncol = 1)
  }
  else if(Outcome == "Contralateral Recurrence (CR)"){
    HaFu = matrix(c(0.003284325,0.003284325,0.006583539,0.006583539,0.009924160,0.013302782,0.013302782,0.016705565,
                    0.016705565,0.020140080,0.023585704,0.023585704,0.023585704,0.027063384,0.027063384,0.030593670,
                    0.030593670,0.030593670,0.034201678,0.034201678,0.037832708,0.041475879,0.045177608,0.045177608,
                    0.045177608,0.045177608,0.045177608,0.045177608,0.045177608,0.048956058,0.048956058,0.048956058,
                    0.048956058,0.048956058,0.048956058,0.048956058,0.048956058,0.048956058,0.048956058,0.052979298,
                    0.057021788,0.057021788,0.061087084,0.061087084,0.061087084,0.065196032,0.065196032,0.065196032,
                    0.065196032,0.069363117,0.069363117,0.069363117,0.069363117,0.069363117,0.069363117,0.069363117,
                    0.073749187,0.073749187,0.073749187,0.073749187,0.073749187,0.073749187,0.073749187,0.078326252,
                    0.078326252,0.078326252,0.082955662,0.082955662,0.082955662,0.082955662,0.082955662,0.082955662,
                    0.082955662,0.087801593,0.087801593,0.092737383,0.092737383,0.092737383,0.092737383,0.092737383,
                    0.092737383,0.092737383,0.092737383,0.092737383,0.092737383,0.092737383,0.098030049,0.098030049,
                    0.098030049,0.098030049,0.098030049,0.098030049,0.098030049,0.098030049,0.098030049,0.098030049,
                    0.098030049,0.098030049,0.098030049,0.098030049,0.098030049,0.098030049,0.098030049,0.098030049,
                    0.098030049,0.098030049,0.098030049,0.098030049,0.098030049,0.098030049,0.098030049,0.098030049,
                    0.098030049,0.098030049,0.098030049,0.098030049,0.098030049,0.098030049,0.098030049,0.098030049,
                    0.098030049,0.098030049,0.098030049,0.098030049,0.098030049,0.098030049,0.098030049,0.098030049,
                    0.098030049,0.098030049,0.098030049,0.105191768,0.105191768,0.105191768,0.105191768,0.105191768,
                    0.105191768,0.105191768,0.105191768,0.105191768,0.105191768,0.105191768,0.105191768,0.105191768,
                    0.113155830,0.113155830,0.113155830,0.113155830,0.113155830,0.113155830,0.113155830,0.113155830,
                    0.113155830,0.113155830,0.113155830,0.113155830,0.113155830,0.113155830,0.113155830,0.113155830,
                    0.113155830,0.122297656,0.122297656,0.122297656,0.122297656,0.122297656,0.122297656,0.122297656,
                    0.122297656,0.122297656,0.122297656,0.122297656,0.122297656,0.122297656,0.122297656,0.132818816,
                    0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,
                    0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,
                    0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,
                    0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,
                    0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,
                    0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,
                    0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,
                    0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,0.143469656,
                    0.191241482,0.191241482,0.191241482,0.191241482,0.191241482,0.191241482,0.191241482,0.191241482,
                    0.191241482,0.191241482,0.191241482,0.191241482,0.191241482,0.191241482,0.191241482,0.191241482), ncol = 1)
    TiFu = matrix(c(0.000000, 7.100000, 8.866667,10.133333,11.033333,13.700000,18.433333,23.000000,24.133333,25.966667,
                    26.000000,26.133333,26.800000,28.566667,28.633333,31.166667,31.366667,33.300000,35.833333,36.433333,
                    38.600000,38.866667,41.233333,42.433333,42.733333,46.800000,48.300000,50.733333,50.833333,52.166667,
                    52.600000,53.200000,54.000000,55.766667,58.033333,58.100000,58.866667,60.266667,60.400000,60.500000,
                    61.133333,63.066667,63.800000,65.333333,68.400000,68.733333,68.766667,68.933333,70.600000,71.266667,
                    71.533333,71.666667,72.733333,73.533333,74.266667,74.433333,75.566667,75.966667,77.266667,78.433333,
                    78.533333,78.833333,79.133333,79.333333,79.533333,79.833333,82.400000,82.433333,82.466667,82.933333,
                    83.800000,84.366667,86.866667,87.433333,88.266667,89.100000,92.400000,94.000000,94.833333,96.133333,
                    96.533333,96.933333,96.966667,97.300000, 99.833333,101.666667,101.966667,102.300000,102.600000,
                    102.700000,102.933333,103.333333,103.466667,103.800000,103.833333,103.900000,104.366667,105.133333,
                    105.233333,105.833333,106.100000,106.700000,106.733333,106.933333,107.800000,108.500000,108.733333,
                    108.766667,109.033333,109.066667,109.300000,109.566667,110.133333,110.266667,110.666667,111.033333,
                    111.100000,111.300000,111.466667,111.500000,111.700000,112.000000,112.133333,112.400000,112.500000,
                    112.900000,113.133333,113.200000,113.300000,113.333333,113.666667,113.700000,114.233333,114.266667,
                    114.466667,114.500000,114.900000,115.100000,115.500000,115.900000,116.000000,116.200000,116.300000,
                    116.566667,116.666667,117.100000,117.266667,117.500000,118.133333,119.200000,119.733333,121.033333,
                    121.266667,121.866667,121.900000,122.566667,123.100000,123.766667,123.800000,124.166667,124.466667,
                    125.000000,125.333333,126.333333,127.233333,127.633333,128.100000,128.366667,128.433333,129.300000,
                    130.033333,130.200000,130.300000,130.333333,130.566667,131.466667,132.000000,132.800000,132.900000,
                    133.366667,133.766667,134.133333,134.433333,134.766667,135.466667,136.033333,136.066667,136.366667,
                    136.400000,136.666667,137.100000,138.066667,138.233333,138.366667,138.400000,138.500000,138.900000,
                    140.900000,142.333333,142.600000,142.766667,142.933333,143.700000,144.066667,144.200000,144.333333,
                    145.466667,145.833333,145.866667,146.333333,147.433333,147.866667,147.900000,148.066667,148.766667,
                    149.033333,149.100000,150.230000,151.066667,151.100000,151.600000,153.433333,153.566667,154.000000,
                    154.400000,154.633333,155.866667,156.833333,157.300000,158.033333,159.433333,159.700000,160.233333,
                    161.566667,162.866667,163.200000,164.000000,164.200000,164.933333,166.866667,167.000000,167.266667,
                    167.500000,168.600000,170.900000,171.333333,172.466667,172.733333,173.833333,175.300000,175.733333,
                    178.300000,189.833333,190.300000,191.400000,223.166667), ncol = 1)
  }
  else if(Outcome == "Disease Free Survival"){
    HaFu = matrix(c(0.003273510,0.006557324,0.009851505,0.009851505,0.013213377,0.016607739,0.020010240,0.023434150,
                    0.026869333,0.030317468,0.033780479,0.037258495,0.037258495,0.040756747,0.044266768,0.047790292,
                    0.047790292,0.051341215,0.058504193,0.058504193,0.062145875,0.065802118,0.069475090,0.069475090,
                    0.073182684,0.076952019,0.076952019,0.080761580,0.084581396,0.088432050,0.092301265,0.096182555,
                    0.100074491,0.104016260,0.107981239,0.111957327,0.111957327,0.115955825,0.119981595,0.124020438,
                    0.128070810,0.132132776,0.132132776,0.136234715,0.136234715,0.140379883,0.144543897,0.148726930,
                    0.152924079,0.157151289,0.157151289,0.161408429,0.165703909,0.170026965,0.170026965,0.170026965,
                    0.174456842,0.178905608,0.183379166,0.183379166,0.187890992,0.187890992,0.192447839,0.197024676,
                    0.206254155,0.210904106,0.215569345,0.215569345,0.220274017,0.225011790,0.225011790,0.229799093,
                    0.229799093,0.229799093,0.229799093,0.229799093,0.229799093,0.229799093,0.229799093,0.234812251,
                    0.239863009,0.244951936,0.244951936,0.250094522,0.250094522,0.255354512,0.260634073,0.265944246,
                    0.265944246,0.265944246,0.265944246,0.271379655,0.271379655,0.271379655,0.271379655,0.276899644,
                    0.276899644,0.282580262,0.288309209,0.288309209,0.288309209,0.288309209,0.294154007,0.300026403,
                    0.300026403,0.300026403,0.300026403,0.300026403,0.300026403,0.306157107,0.306157107,0.306157107,
                    0.306157107,0.306157107,0.306157107,0.306157107,0.306157107,0.306157107,0.306157107,0.306157107,
                    0.306157107,0.306157107,0.306157107,0.306157107,0.306157107,0.306157107,0.306157107,0.306157107,
                    0.306157107,0.306157107,0.306157107,0.306157107,0.306157107,0.306157107,0.306157107,0.306157107,
                    0.306157107,0.306157107,0.306157107,0.306157107,0.313857082,0.313857082,0.313857082,0.313857082,
                    0.313857082,0.313857082,0.313857082,0.313857082,0.322040951,0.322040951,0.322040951,0.322040951,
                    0.322040951,0.322040951,0.322040951,0.322040951,0.322040951,0.330885930,0.330885930,0.330885930,
                    0.330885930,0.330885930,0.330885930,0.330885930,0.330885930,0.330885930,0.330885930,0.340986413,
                    0.340986413,0.340986413,0.340986413,0.340986413,0.340986413,0.340986413,0.340986413,0.340986413,
                    0.352051772,0.352051772,0.352051772,0.352051772,0.352051772,0.352051772,0.352051772,0.352051772,
                    0.352051772,0.352051772,0.352051772,0.352051772,0.352051772,0.352051772,0.352051772,0.365048937,
                    0.378183360,0.391616718,0.391616718,0.391616718,0.405674272,0.405674272,0.405674272,0.405674272,
                    0.405674272,0.420508023,0.435658540,0.435658540,0.435658540,0.435658540,0.435658540,0.435658540,
                    0.435658540,0.435658540,0.435658540,0.435658540,0.435658540,0.435658540,0.435658540,0.435658540,
                    0.435658540,0.435658540,0.435658540,0.435658540,0.435658540,0.435658540,0.435658540,0.435658540,
                    0.458677718,0.458677718,0.458677718,0.458677718,0.458677718,0.458677718,0.458677718,0.458677718,
                    0.458677718,0.458677718,0.458677718,0.458677718,0.458677718,0.458677718,0.458677718,0.458677718,
                    0.458677718,0.458677718,0.458677718,0.458677718,0.458677718,0.458677718,0.458677718,0.458677718,
                    0.458677718,0.458677718,0.525089213,0.525089213,0.525089213,0.525089213,0.525089213,0.525089213,
                    0.525089213,0.525089213,0.525089213,0.525089213,0.525089213,0.525089213,0.525089213,0.525089213), ncol = 1)
    TiFu = matrix(c(0.000000,  4.733333,  6.466667,  7.100000,  7.800000,  8.866667, 11.033333, 11.366667, 12.433333, 
                    13.700000, 14.266667, 17.433333, 18.433333, 20.566667, 22.800000, 23.000000, 24.133333, 25.966667, 
                    26.000000, 26.133333, 26.700000, 27.700000, 28.566667, 28.633333, 29.000000, 31.166667, 31.366667, 
                    31.900000, 32.266667, 35.600000, 35.833333, 38.600000, 38.866667, 41.100000, 41.233333, 41.533333, 
                    42.733333, 43.100000, 43.266667, 45.033333, 46.466667, 46.700000, 46.800000, 47.933333, 48.300000, 
                    48.866667, 49.966667, 50.000000, 50.333333, 50.700000, 50.733333, 52.033333, 52.166667, 53.033333, 
                    53.200000, 54.000000, 54.200000, 54.733333, 55.133333, 55.766667, 56.566667, 58.100000, 59.433333, 
                    60.500000, 61.133333, 61.400000, 63.800000, 65.333333, 65.633333, 68.733333, 68.933333, 69.833333, 
                    70.600000, 71.533333, 71.666667, 72.733333, 73.533333, 74.266667, 74.433333, 74.566667, 75.566667, 
                    76.966667, 78.833333, 78.900000, 79.133333, 79.333333, 81.600000, 82.400000, 82.433333, 82.466667, 
                    82.933333, 83.200000, 83.800000, 84.366667, 86.866667, 87.433333, 88.266667, 89.066667, 89.100000, 
                    90.133333, 92.400000, 94.000000, 94.100000, 95.333333, 96.133333, 96.533333, 96.933333, 97.300000,
                    101.666667,101.966667,102.166667,102.300000,102.600000,102.700000,102.933333,103.333333,103.466667,
                    103.766667,103.800000,103.833333,103.900000,104.366667,105.233333,105.833333,106.100000,106.733333,
                    106.933333,107.800000,108.500000,108.733333,108.766667,109.033333,109.066667,109.300000,109.566667,
                    110.133333,110.166667,110.266667,110.533333,110.666667,111.033333,111.100000,111.300000,111.466667,
                    111.500000,111.700000,112.000000,112.133333,112.300000,112.400000,112.500000,112.900000,113.133333,
                    113.200000,113.300000,113.333333,113.666667,113.700000,114.233333,114.266667,114.900000,115.100000,
                    115.500000,115.900000,116.200000,116.300000,116.566667,116.666667,117.100000,117.266667,118.133333,
                    119.733333,121.033333,121.266667,121.900000,122.566667,122.900000,123.100000,123.766667,123.800000,
                    124.466667,125.333333,126.333333,127.233333,127.633333,128.366667,128.433333,129.300000,130.033333,
                    130.300000,130.333333,131.466667,131.966667,132.000000,132.800000,132.900000,133.066667,133.366667,
                    133.766667,134.133333,134.433333,135.466667,136.166667,136.366667,136.400000,136.666667,138.066667,
                    138.233333,138.366667,138.400000,138.500000,138.900000,140.900000,142.333333,142.600000,142.766667,
                    142.933333,143.700000,144.066667,144.333333,145.466667,145.833333,146.333333,147.433333,147.466667,
                    147.866667,148.066667,149.033333,149.100000,150.230000,151.066667,151.100000,151.600000,153.566667,
                    154.000000,154.400000,154.633333,155.866667,156.833333,157.300000,159.433333,159.700000,160.233333,
                    161.566667,162.233333,162.866667,163.200000,164.200000,164.933333,166.866667,167.000000,167.266667,
                    167.500000,168.600000,170.900000,171.333333,172.466667,172.733333,173.833333,175.300000,175.733333,
                    178.300000,189.833333,191.400000), ncol = 1)
  }
  else if(Outcome == "Dead to Breast Cancer (DOBC)"){
    HaFu = matrix(c(0.000000000,0.002953126,0.002953126,0.002953126,0.005980015,0.005980015,0.005980015,
                    0.009051168,0.009051168,0.009051168,.012150099 ,.015259878 ,.018382971 ,.018382971 ,
                    .018382971 ,.018382971 ,.018382971 ,.021563754 ,.024758467 ,.027958903 ,.027958903 ,
                    .027958903 ,.031277969 ,.031277969 ,.031277969 ,.031277969 ,.034685753 ,.038110395 ,
                    .041609914 ,.041609914 ,.041609914 ,.045167422 ,.045167422 ,.045167422 ,.045167422 ,
                    .045167422 ,.045167422 ,.045167422 ,.045167422 ,.048835618 ,.052511360 ,.056194679 ,
                    .059897702 ,.059897702 ,.059897702 ,.063671250 ,.063671250 ,.067492630 ,.067492630 ,
                    .071338779 ,.075219544 ,.079121065 ,.079121065 ,.079121065 ,.079121065 ,.083102504 ,
                    .083102504 ,.083102504 ,.083102504 ,.087156591 ,.087156591 ,.087156591 ,.087156591 ,
                    .087156591 ,.087156591 ,.091328891 ,.091328891 ,.091328891 ,.091328891 ,.095573428 ,
                    .095573428 ,.095573428 ,.095573428 ,.095573428 ,.099917086 ,.099917086 ,.099917086 ,
                    .099917086 ,.099917086 ,.099917086 ,.099917086 ,.099917086 ,.099917086 ,.099917086 ,
                    .099917086 ,.099917086 ,.099917086 ,.099917086 ,.099917086 ,.099917086 ,.099917086 ,
                    .099917086 ,.099917086 ,.099917086 ,.099917086 ,.099917086 ,.099917086 ,.099917086 ,
                    .099917086 ,.099917086 ,.099917086 ,.099917086 ,.099917086 ,.099917086 ,.099917086 ,
                    .099917086 ,.099917086 ,.099917086 ,.099917086 ,.099917086 ,.099917086 ,.099917086 ,
                    .099917086 ,.099917086 ,.099917086 ,.099917086 ,.099917086 ,.099917086 ,.099917086 ,
                    .099917086 ,.099917086 ,.099917086 ,.099917086 ,.099917086 ,.099917086 ,.099917086 ,
                    .099917086 ,.099917086 ,.099917086 ,.106230488 ,.106230488 ,.106230488 ,.106230488 ,
                    .106230488 ,.106230488 ,.106230488 ,.106230488 ,.106230488 ,.106230488 ,.106230488 ,
                    .106230488 ,.113525547 ,.113525547 ,.113525547 ,.113525547 ,.121073617 ,.121073617 ,
                    .121073617 ,.121073617 ,.121073617 ,.121073617 ,.128910814 ,.128910814 ,.128910814 ,
                    .128910814 ,.128910814 ,.128910814 ,.128910814 ,.128910814 ,.128910814 ,.128910814 ,
                    .128910814 ,.128910814 ,.128910814 ,.128910814 ,.128910814 ,.128910814 ,.128910814 ,
                    .128910814 ,.128910814 ,.128910814 ,.128910814 ,.128910814 ,.128910814 ,.128910814 ,
                    .128910814 ,.138420266 ,.148032611 ,.148032611 ,.148032611 ,.148032611 ,.148032611 ,
                    .148032611 ,.148032611 ,.148032611 ,.148032611 ,.148032611 ,.148032611 ,.148032611 ,
                    .148032611 ,.148032611 ,.148032611 ,.148032611 ,.148032611 ,.148032611 ,.148032611 ,
                    .148032611 ,.148032611 ,.148032611 ,.148032611 ,.148032611 ,.161011185 ,.161011185 ,
                    .161011185 ,.161011185 ,.161011185 ,.161011185 ,.161011185 ,.161011185 ,.161011185 ,
                    .161011185 ,.161011185 ,.161011185 ,.161011185 ,.161011185 ,.161011185 ,.161011185 ,
                    .161011185 ,.161011185 ,.161011185 ,.161011185 ,.161011185 ,.161011185 ,.161011185 ,
                    .161011185 ,.161011185 ,.161011185 ,.161011185 ,.161011185 ,.161011185 ,.161011185 ,
                    .161011185 ,.161011185 ,.161011185 ,.161011185 ,.161011185 ,.161011185 ,.161011185 ,
                    .161011185 ,.161011185 ,.161011185 ,.161011185 ,.161011185 ,.161011185 ,.161011185 ,
                    .161011185 ,.161011185 ,.161011185 ,.161011185 ,.161011185 ,.161011185 ,.161011185 ,
                    .161011185 ,.161011185 ,.161011185 ,.161011185 ,.161011185 ,.161011185 ,.161011185 ,
                    .161011185), ncol = 1)
    TiFu = matrix(c(7.10000,10.13333,13.73333,18.20000,23.00000,24.13333,26.13333,26.80000,28.63333,31.36667,
                    33.30000,36.43333,42.43333,42.73333,46.80000,48.30000,50.73333,50.83333,52.60000,53.20000,
                    54.00000,55.76667,58.03333,58.10000,58.86667,59.53333,60.26667,60.40000,63.06667,65.23333,
                    65.33333,68.40000,68.93333,70.60000,71.53333,71.66667,72.73333,73.53333,74.26667,75.96667,
                    77.26667,78.43333,78.53333,78.83333,79.13333,79.53333,79.60000,79.83333,82.43333,82.46667,
                    83.80000,84.26667,84.36667,84.76667,86.86667,87.90000,88.26667,90.13333,94.00000,94.83333,
                    96.10000,96.13333,96.53333,96.56667,96.93333,96.96667,97.30000,98.06667,98.90000,99.06667,
                    99.83333,100.96667,101.66667,102.16667,102.17000,102.30000,102.60000,102.70000,102.93333,
                    103.33333,103.46667,103.76667,103.80000,103.83333,103.90000,104.36667,104.43333,104.50000,
                    105.23333,105.83333,106.10000,106.70000,106.73333,106.93333,107.80000,108.50000,108.73333,
                    108.76667,109.03333,109.06667,109.30000,109.56667,109.73333,110.13333,110.16667,110.26667,
                    110.53333,110.60000,110.66667,111.03333,111.10000,111.30000,111.46667,111.50000,111.70000,
                    112.00000,112.13333,112.40000,112.50000,112.90000,113.10000,113.13333,113.20000,113.30000,
                    113.33333,113.66667,114.23333,114.26667,114.46667,114.50000,114.90000,115.10000,115.50000,
                    115.56667,115.90000,116.20000,116.56667,117.10000,117.26667,117.50000,118.13333,119.20000,
                    119.73333,121.03333,121.26667,121.86667,121.90000,122.56667,123.10000,123.76667,123.80000,
                    124.16667,124.46667,125.33333,126.33333,127.23333,127.63333,128.10000,128.36667,128.43333,
                    129.30000,129.40000,130.03333,130.20000,130.30000,130.33333,130.56667,132.70000,132.80000,
                    132.90000,133.36667,133.76667,134.13333,134.43333,134.76667,135.46667,136.03333,136.06667,
                    136.36667,136.40000,136.50000,136.66667,137.10000,138.06667,138.23333,138.36667,138.40000,
                    138.50000,138.90000,140.90000,142.33333,142.40000,142.60000,142.76667,142.93333,143.70000,
                    144.06667,144.20000,144.33333,145.46667,145.83333,145.86667,146.33333,147.43333,147.86667,
                    147.90000,148.06667,148.66667,148.76667,149.03333,149.10000,150.20000,151.06667,151.10000,
                    151.60000,152.46667,153.43333,153.56667,154.00000,154.33333,154.40000,154.46667,154.63333,
                    155.86667,156.83333,157.30000,157.53333,158.03333,159.43333,159.70000,160.10000,160.20000,
                    160.23333,161.56667,162.23333,163.20000,163.43333,164.00000,164.20000,164.93333,166.86667,
                    167.26667,167.50000,168.60000,170.90000,171.33333,172.46667,172.73333,173.83333,175.30000,
                    175.73333,178.30000,184.03333,188.30000,189.83333,190.30000,191.40000,204.20000,221.03333,
                    223.16667), ncol = 1)
  }
  else if(Outcome == "Overall Survival"){
    HaFu = matrix(c(0.000000000,0.003225237,0.003225237,0.006495497,0.009773882,0.009773882,0.013088567,
                    0.016411599,0.019751304,0.019751304,0.023117767,0.026498734,0.029896963,0.033324622,
                    0.036761207,0.036761207,0.036761207,0.040233807,0.043724619,0.047224690,0.050777847,
                    0.050777847,0.054369424,0.057981939,0.057981939,0.057981939,0.061659642,0.065348386,
                    0.069084746,0.072843771,0.072843771,0.076624333,0.076624333,0.076624333,0.080448142,
                    0.080448142,0.080448142,0.084305480,0.084305480,0.088226808,0.092159824,0.096104595,
                    0.100062072,0.100062072,0.100062072,0.104091615,0.104091615,0.108175202,0.108175202,
                    0.112292958,0.116440041,0.120613124,0.120613124,0.120613124,0.120613124,0.124876557,
                    0.124876557,0.129168750,0.133488801,0.137832766,0.137832766,0.137832766,0.137832766,
                    0.142244809,0.142244809,0.146721727,0.146721727,0.146721727,0.146721727,0.151287404,
                    0.151287404,0.151287404,0.151287404,0.151287404,0.155967705,0.155967705,0.155967705,
                    0.155967705,0.155967705,0.155967705,0.155967705,0.155967705,0.155967705,0.155967705,
                    0.155967705,0.155967705,0.155967705,0.155967705,0.155967705,0.155967705,0.155967705,
                    0.155967705,0.161154207,0.161154207,0.161154207,0.166451769,0.166451769,0.166451769,
                    0.166451769,0.166451769,0.166451769,0.171916300,0.171916300,0.171916300,0.171916300,
                    0.171916300,0.171916300,0.171916300,0.177708639,0.177708639,0.177708639,0.177708639,
                    0.177708639,0.177708639,0.177708639,0.177708639,0.177708639,0.177708639,0.177708639,
                    0.177708639,0.177708639,0.177708639,0.177708639,0.177708639,0.177708639,0.177708639,
                    0.177708639,0.177708639,0.177708639,0.177708639,0.184609182,0.184609182,0.184609182,
                    0.184609182,0.184609182,0.184609182,0.184609182,0.184609182,0.184609182,0.184609182,
                    0.184609182,0.184609182,0.192437283,0.192437283,0.192437283,0.192437283,0.200552925,
                    0.200552925,0.200552925,0.200552925,0.200552925,0.200552925,0.209067635,0.209067635,
                    0.209067635,0.209067635,0.209067635,0.209067635,0.209067635,0.209067635,0.209067635,
                    0.209067635,0.209067635,0.209067635,0.209067635,0.218606822,0.218606822,0.218606822,
                    0.218606822,0.218606822,0.218606822,0.218606822,0.218606822,0.218606822,0.218606822,
                    0.218606822,0.218606822,0.229365694,0.240274121,0.240274121,0.240274121,0.240274121,
                    0.252085380,0.252085380,0.252085380,0.252085380,0.252085380,0.252085380,0.252085380,
                    0.252085380,0.252085380,0.252085380,0.252085380,0.252085380,0.252085380,0.252085380,
                    0.252085380,0.252085380,0.252085380,0.252085380,0.252085380,0.252085380,0.267645326,
                    0.267645326,0.267645326,0.267645326,0.267645326,0.267645326,0.267645326,0.267645326,
                    0.267645326,0.267645326,0.267645326,0.267645326,0.267645326,0.267645326,0.267645326,
                    0.267645326,0.267645326,0.267645326,0.267645326,0.267645326,0.267645326,0.267645326,
                    0.267645326,0.267645326,0.267645326,0.267645326,0.267645326,0.267645326,0.267645326,
                    0.267645326,0.267645326,0.267645326,0.267645326,0.267645326,0.267645326,0.267645326,
                    0.267645326,0.303681429,0.303681429,0.303681429,0.303681429,0.303681429,0.303681429,
                    0.303681429,0.303681429,0.303681429,0.303681429,0.303681429,0.303681429,0.303681429,
                    0.303681429,0.303681429,0.303681429,0.303681429,0.303681429,0.303681429,0.303681429,
                    0.303681429,0.303681429), ncol = 1)
    TiFu = matrix(c(7.10000,10.13333,13.73333,18.20000,23.00000,24.13333,26.13333,26.80000,28.63333,31.36667,
                    33.30000,36.43333,42.43333,42.73333,46.80000,48.30000,50.73333,50.83333,52.60000,53.20000,
                    54.00000,55.76667,58.03333,58.10000,58.86667,59.53333,60.26667,60.40000,63.06667,65.23333,
                    65.33333,68.40000,68.93333,70.60000,71.53333,71.66667,72.73333,73.53333,74.26667,75.96667,
                    77.26667,78.43333,78.53333,78.83333,79.13333,79.53333,79.60000,79.83333,82.43333,82.46667,
                    83.80000,84.26667,84.36667,84.76667,86.86667,87.90000,88.26667,90.13333,94.00000,94.83333,
                    96.10000,96.13333,96.53333,96.56667,96.93333,96.96667,97.30000,98.06667,98.90000,99.06667,
                    99.83333,100.96667,101.66667,102.16667,102.17000,102.30000,102.60000,102.70000,102.93333,
                    103.33333,103.46667,103.76667,103.80000,103.83333,103.90000,104.36667,104.43333,104.50000,
                    105.23333,105.83333,106.10000,106.70000,106.73333,106.93333,107.80000,108.06667,108.50000,
                    108.73333,108.76667,109.03333,109.06667,109.30000,109.56667,109.73333,110.13333,110.16667,
                    110.26667,110.53333,110.60000,110.66667,111.03333,111.10000,111.30000,111.46667,111.50000,
                    111.70000,112.00000,112.13333,112.40000,112.50000,112.90000,113.10000,113.13333,113.20000,
                    113.30000,113.33333,113.66667,114.23333,114.26667,114.46667,114.50000,114.90000,115.10000,
                    115.50000,115.56667,115.90000,116.20000,116.56667,117.10000,117.26667,117.50000,118.13333,
                    119.20000,119.73333,121.03333,121.26667,121.86667,121.90000,122.56667,123.10000,123.76667,
                    123.80000,124.16667,124.46667,125.33333,126.33333,127.23333,127.63333,128.10000,128.36667,
                    128.43333,129.30000,129.40000,130.03333,130.20000,130.30000,130.33333,130.56667,132.70000,
                    132.80000,132.90000,133.36667,133.76667,134.13333,134.43333,134.76667,135.46667,136.03333,
                    136.06667,136.36667,136.40000,136.50000,136.66667,137.10000,138.06667,138.23333,138.36667,
                    138.40000,138.50000,138.90000,140.90000,142.33333,142.40000,142.60000,142.76667,142.93333,
                    143.70000,144.06667,144.20000,144.33333,145.46667,145.83333,145.86667,146.33333,147.43333,
                    147.86667,147.90000,148.06667,148.66667,148.76667,149.03333,149.10000,150.20000,151.06667,
                    151.10000,151.60000,152.46667,153.43333,153.56667,154.00000,154.33333,154.40000,154.46667,
                    154.63333,155.86667,156.83333,157.30000,157.53333,158.03333,159.43333,159.70000,160.10000,
                    160.20000,160.23333,161.56667,162.23333,163.20000,163.43333,164.00000,164.20000,164.93333,
                    166.86667,167.26667,167.50000,168.60000,170.90000,171.33333,172.46667,172.73333,173.83333,
                    175.30000,175.73333,178.30000,184.03333,188.30000,189.83333,190.30000,191.40000,204.20000,
                    221.03333,223.16667), ncol = 1)
  }
  CoxBaseline = cbind(TiFu, HaFu)
  return(CoxBaseline)
  
}

####Function to identify the right sets of beta in Cox Model####
detectCoxOutcome = function(Outcome) {
  if(Outcome == "Ipsilateral Recurrence (IBTR)"){
    betaCoxMut = 0.1316
    betaCoxAge = 0.6815
    betaCoxStage = -0.1955
    betaCoxNode = 0.1981
  }
  else if(Outcome == "Distant Recurrence (DR)"){
    betaCoxMut = 0.3439
    betaCoxAge = 0.1156
    betaCoxStage = 0.7614
    betaCoxNode = 0.6129
  }
  else if(Outcome == "Contralateral Recurrence (CR)"){
    betaCoxMut = 1.29977
    betaCoxAge = 0.23179
    betaCoxStage = -0.42485
    betaCoxNode = 0.02253
    
  }
  else if(Outcome == "Disease Free Survival"){
    betaCoxMut = 0.9584
    betaCoxAge = 0.1318
    betaCoxStage = 0.3075
    betaCoxNode = 0.4378
  }
  else if(Outcome == "Dead to Breast Cancer (DOBC)"){
    betaCoxMut = 0.5685
    betaCoxAge = 0.2495
    betaCoxStage = 0.8959
    betaCoxNode = 0.6988
  }
  else if(Outcome == "Overall Survival"){
    betaCoxMut = 0.7612
    betaCoxAge = -0.4483
    betaCoxStage = 0.6845
    betaCoxNode = 0.5198
  }
  
  betaCox = c(betaCoxMut, betaCoxAge, betaCoxStage, betaCoxNode)
  return(betaCox)
}

####Function to identify the right set of beta in Weibull Model####
detectWeibullOutcome = function(Outcome){
  if(Outcome == "Ipsilateral Recurrence (IBTR)"){
    betaWeibullMut = -0.151
    betaWeibullAge = -0.458
    betaWeibullStage = 0.115
    betaWeibullNode = -0.120
    intercept = 6.526
    SCALE = 0.656
  }
  else if(Outcome == "Distant Recurrence (DR)"){
    betaWeibullMut = -0.2388
    betaWeibullAge = -0.0851
    betaWeibullStage = -0.6290
    betaWeibullNode = -0.5351
    intercept = 6.6338
    SCALE = 0.841
  }
  else if(Outcome == "Dead to Breast Cancer (DOBC)"){
    betaWeibullMut = -0.309
    betaWeibullAge = -0.149
    betaWeibullStage = -0.552
    betaWeibullNode = -0.453
    intercept = 6.532
    SCALE = 0.622
  }
  else if(Outcome == "Overall Survival"){
    betaWeibullMut = -0.409
    betaWeibullAge = 0.275
    betaWeibullStage = -0.431
    betaWeibullNode = -0.327
    intercept = 5.995
    SCALE = 0.613
  }
  
  betaWeibull = c(intercept, betaWeibullMut, betaWeibullAge, betaWeibullStage, betaWeibullNode, SCALE)
  return(betaWeibull)
}

####Function to identify the right set of beta in Exponential Model####
detectExpOutcome = function(Outcome){
  if(Outcome == "Ipsilateral Recurrence (IBTR)"){
    betaExpMut = -0.2274
    betaExpAge = -0.7284
    betaExpStage = 0.1876
    betaExpNode = -0.1516
    intercept = 7.41828
  }
  else if(Outcome == "Distant Recurrence (DR)"){
    betaExpMut = -0.29289
    betaExpAge = -0.11311068
    betaExpStage = -0.738844
    betaExpNode = -0.6794332
    intercept = 6.9763125
  }
  else if(Outcome == "Dead to Breast Cancer (DOBC)"){
    betaExpMut = -0.51906
    betaExpAge = -0.267681
    betaExpStage = -0.8546295
    betaExpNode = -0.6921024
    intercept = 7.5468746
  }
  else if(Outcome == "Overall Survival"){
    betaExpMut = -0.7011763
    betaExpAge = 0.4200157
    betaExpStage = -0.6597071
    betaExpNode = -0.5270557
    intercept = 6.7224832
  }
  betaExp = c(intercept, betaExpMut, betaExpAge, betaExpStage, betaExpNode)
  return(betaExp)
}

####Function to identify the right set of beta in Log Model####
detectLogOutcome = function(Outcome){
  if(Outcome == "Ipsilateral Recurrence (IBTR)"){
    betaLogMut = -0.24434
    betaLogAge = -0.538602
    betaLogStage = 0.030538
    betaLogNode = -0.03695461
    intercept = 6.75198863
    SCALE = 1.330906
  }
  else if(Outcome == "Distant Recurrence (DR)"){
    betaLogMut = -0.46448243
    betaLogAge = -0.02933233
    betaLogStage = -0.88349975
    betaLogNode = -0.49849554
    intercept = 6.60852002
    SCALE = 1.440605
  }
  else if(Outcome == "Dead to Breast Cancer (DOBC)"){
    betaLogMut = -0.427407
    betaLogAge = -0.152554
    betaLogStage = -0.7005554
    betaLogNode = -0.478896
    intercept = 6.595284
    SCALE = 1.119281
  }
  else if(Outcome == "Overall Survival"){
    betaLogMut = -0.6084585
    betaLogAge = 0.2978616
    betaLogStage = -0.52839
    betaLogNode = -0.3209508
    intercept = 5.9880269
    SCALE = 1.074927
  }
  
  betaLog = c(intercept, betaLogMut, betaLogAge, betaLogStage, betaLogNode, SCALE)
  return(betaLog)
}


####Function to Calculate Cox Cumulative Baseline####
CoxCumulativeBaseline = function(CoxTime, CoxBaseline){
  #set up for iteration
  i = 1
  #need to match the user input's time to a time in the baseline function
  while(i < nrow(CoxBaseline)){
    if(CoxTime < CoxBaseline[1,1]){
      CumHaz = 0
      break
    }
    else if(CoxTime <= CoxBaseline[i+1,1] && CoxTime > CoxBaseline[i, 1]){
      #need to assign the cumhaz to the next level to have a more conservative estimate
      CumHaz = CoxBaseline[i+1, 2]
      break
    }
    
    i = i+1
  }
  
  return(CumHaz)
}

####Function to output the patients' risk factors in a string####
RiskFactorReport = function(x1, x2, x3, x4){
  if(x1 == 0){
    MutStats = "a non-mutation carrier,"
  }
  else{MutStats = "a mutation carrier,"}
  
  if(x2 == 0){
    AgeStats = "diagnosed with breast cancer at age over 50,"
  }
  else{AgeStats = "diagnosed with breast cancer at age under 50,"}
  
  if(x3 == 0){
    TumorStats = "with tumor stage 1,"
  }
  else{TumorStats = "with tumor stage 2,"}
  
  if(x4 == 0){
    NodeStats = "and without lymph node invovlement is"
  }
  else{NodeStats = "and with lymph node invovlement is"}
  
  StatsReport = paste(MutStats, AgeStats, TumorStats, NodeStats)
  return(StatsReport)
}


################UI Function####################
ui = navbarPage(
  "Survival Probability",
  
  ####Create the first tab to calculate the survival probability of Cox Model####
  tabPanel(
    "Cox Model",
    sidebarPanel(
      width = 4,
      selectInput("OutcomeCoxCurve", "Outcome to Examine", 
                  choices = c("Dead to Breast Cancer (DOBC)", "Ipsilateral Recurrence (IBTR)", 
                              "Contralateral Recurrence (CR)", "Distant Recurrence (DR)", 
                              "Disease Free Survival", "Overall Survival")),
      textInput("TimeCoxCurve", "Time (must be within the given data's range)", value = 60),
      sliderInput("x1", "Mutation Status (0-No Mutation, 1-Mutation)",
                  min = 0, max = 1, value = 0, step = 1, tick = FALSE),
      sliderInput("x2", "Age (0-Over 50, 1-Under 50)",
                  min = 0, max = 1, value = 0, step = 1, tick = FALSE),
      sliderInput("x3", "Tumor Stage (0-Stage 1, 1-Stage 2)",
                  min = 0, max = 1, value = 0, step = 1, tick = FALSE),
      sliderInput("x4", "Node (0-No Node, 1-Yes Node)",
                  min = 0, max = 1, value = 0, step = 1, tick = FALSE),
      actionButton("GenerateCoxCurve", "Estimation", style = "color: #EDDACC; background-color:#4b3b42"),
      uiOutput("CoxXLen"),
      uiOutput("CoxYLen")
    ),
    mainPanel(
      helpText("The fitted Cox model has outcomes: Dead to Breast Cancer, factors: Mutation Status, Age, 
               Tumor Stage, and Node Involvement. 
               The beta was the log hazard ratio derived from R results of the cox model"),
      br(),
      textOutput("CoxSurvivalProbability"),
      textOutput("DescriptionOfCoxCurve"),
      plotOutput("CoxCurve"),
      br(),
      textOutput("NoteCoxCurve")
    )
  ),
  
  ####Create the second tab to calculate the survival probability of Weibull Model####
  tabPanel(
    "Weibull Model",
    sidebarPanel(
      width = 4,
      selectInput("OutcomeWeibullCurve", "Outcome to Examine", 
                  choices = c("Dead to Breast Cancer (DOBC)", "Ipsilateral Recurrence (IBTR)", 
                              "Distant Recurrence (DR)", "Overall Survival")),
      textInput("TimeWeibullCurve", "Time (must be within the given data's range", value = 60),
      sliderInput("X1", "Mutation Status (0-No Mutation, 1-Mutation)",
                  min = 0, max = 1, value = 0, step = 1, tick = FALSE),
      sliderInput("X2", "Age (0-Over 50, 1-Under 50)",
                  min = 0, max = 1, value = 0, step = 1, tick = FALSE),
      sliderInput("X3", "Tumor Stage (0-Stage 1, 1-Stage 2)",
                  min = 0, max = 1, value = 0, step = 1, tick = FALSE),
      sliderInput("X4", "Node (0-No Node, 1-Yes Node)",
                  min = 0, max = 1, value = 0, step = 1, tick = FALSE),
      actionButton("GenerateWeibullCurve", "Estimation", style = "color: #EDDACC; background-color:#4b3b42"),
      uiOutput("WeibullXLen"),
      uiOutput("WeibullYLen")
    ),
    mainPanel(
      helpText("The fitted Weibull Model has outcome: Dead to Breast Cancer, factors: Mutation Status, Age, 
               Tumor Stage, and Node Invovlement.
               The beta was derived from R results of the Weibull model.
               
               The outcome to choose from only contains the outcomes that do not have any value with t = 0."),
      br(),
      textOutput("WeibullSurvivalProbability"),
      textOutput("DescriptionOfWeibullCurve"),
      plotOutput("WeibullCurve"),
      br(),
      textOutput("NoteWeibullCurve")
    )
  ),
  
  ####Create the third tab to calculate the survival probability of Exponential Model####
  tabPanel(
    "Exponential Model",
    sidebarPanel(
      width = 4,
      selectInput("OutcomeExpCurve", "Outcome to Examine", 
                  choices = c("Dead to Breast Cancer (DOBC)", "Ipsilateral Recurrence (IBTR)", 
                              "Distant Recurrence (DR)", "Overall Survival")),
      textInput("TimeExpCurve", "Time (must be within the given data's range", value = 60),
      sliderInput("x11", "Mutation Status (0-No Mutation, 1-Mutation)",
                  min = 0, max = 1, value = 0, step = 1, tick = FALSE),
      sliderInput("x22", "Age (0-Over 50, 1-Under 50)",
                  min = 0, max = 1, value = 0, step = 1, tick = FALSE),
      sliderInput("x33", "Tumor Stage (0-Stage 1, 1-Stage 2)",
                  min = 0, max = 1, value = 0, step = 1, tick = FALSE),
      sliderInput("x44", "Node (0-No Node, 1-Yes Node)",
                  min = 0, max = 1, value = 0, step = 1, tick = FALSE),
      actionButton("GenerateExpCurve", "Estimation", style = "color: #EDDACC; background-color:#4b3b42"),
      uiOutput("ExpXLen"),
      uiOutput("ExpYLen")
    ),
    mainPanel(
      helpText("The fitted Weibull Model has outcome: Dead to Breast Cancer, factors: Mutation Status, Age, 
               Tumor Stage, and Node Invovlement.
               The beta was derived from R results of the Exponential model.
               
               The outcome to choose from only contains the outcomes that do not have any value with t = 0."),
      br(),
      textOutput("ExpSurvivalProbability"),
      textOutput("DescriptionOfExpCurve"),
      plotOutput("ExpCurve"),
      br(),
      textOutput("NoteExpCurve")
    )
  ),
  ####Create the third tab to calculate the survival probability of Log-Normal Model####
  tabPanel(
    "Log-Normal Model",
    sidebarPanel(
      width = 4,
      selectInput("OutcomeLNCurve", "Outcome to Examine", 
                  choices = c("Dead to Breast Cancer (DOBC)", "Ipsilateral Recurrence (IBTR)", 
                              "Distant Recurrence (DR)", "Overall Survival")),
      textInput("TimeLNCurve", "Time (must be within the given data's range", value = 60),
      sliderInput("X11", "Mutation Status (0-No Mutation, 1-Mutation)",
                  min = 0, max = 1, value = 0, step = 1, tick = FALSE),
      sliderInput("X22", "Age (0-Over 50, 1-Under 50)",
                  min = 0, max = 1, value = 0, step = 1, tick = FALSE),
      sliderInput("X33", "Tumor Stage (0-Stage 1, 1-Stage 2)",
                  min = 0, max = 1, value = 0, step = 1, tick = FALSE),
      sliderInput("X44", "Node (0-No Node, 1-Yes Node)",
                  min = 0, max = 1, value = 0, step = 1, tick = FALSE),
      actionButton("GenerateLNCurve", "Estimation", style = "color: #EDDACC; background-color:#4b3b42"),
      uiOutput("LNXLen"),
      uiOutput("LNYLen")
    ),
    mainPanel(
      helpText("The fitted Weibull Model has outcome: Dead to Breast Cancer, factors: Mutation Status, Age, 
               Tumor Stage, and Node Invovlement.
               The beta was derived from R results of the Log-Normal model.
               
               The outcome to choose from only contains the outcomes that do not have any value with t = 0."),
      br(),
      textOutput("LNSurvivalProbability"),
      textOutput("DescriptionOfLNCurve"),
      plotOutput("LNCurve"),
      br(),
      textOutput("NoteLNCurve")
      )
    )
)


########################Server Function########################
server = function(input, output, session) {
  
  ###########CoxModel Survival Probability###########
  observeEvent(input$GenerateCoxCurve,{
    ####Read in the choice of the outcome####
    CoxOutcome = input$OutcomeCoxCurve
    betaCox = detectCoxOutcome(CoxOutcome)
    CoxBetaMatrix = matrix(betaCox, ncol = 1)
    ####Read in the choice of risk factor and time####
    CoxTime = as.numeric(input$TimeCoxCurve)
    CoxX1 = input$x1
    CoxX2 = input$x2
    CoxX3 = input$x3
    CoxX4 = input$x4
    CoxRiskFactorMatrix = matrix(c(CoxX1, CoxX2, CoxX3, CoxX4), nrow = 1)
    ####Calculate basehaz for each outcome####
    CoxBaseline = detectCoxBaseline(CoxOutcome)
    ####Calculate cumulative baseline hazard using the function####
    CoxCumHaz = CoxCumulativeBaseline(CoxTime, CoxBaseline)
    ####Calculate S_o(t) and xbeta
    Snull = exp(-CoxCumHaz)
    xbeta = exp(as.double(CoxRiskFactorMatrix %*% CoxBetaMatrix))
    ####Calculate S(t)####
    CoxSurvivalProbability = Snull^xbeta
    
    ####Output the Cox results####
    output$CoxSurvivalProbability = 
      renderText(paste("The survival Probability for the patient who is", 
                       RiskFactorReport(CoxX1, CoxX2, CoxX3, CoxX4), round(100*CoxSurvivalProbability, 2)))
    ####Output the length of x and y axis (uioutput)####
    output$CoxXLen = renderUI({
      sliderInput("CoxLength", "X-axis Length", min = 0, max = 230, step = 1, value = c(0,230))
    })
    output$CoxYLen = renderUI({
      sliderInput("CoxHeight", "Y-axis Length", min = 0, max = 1, step = 0.1, value = c(0,1))
    })
    ####Output the Cox Curve####
    output$DescriptionofCoxCurve = renderText({"This patient has a following estimated survival probability curve:"})
    output$CoxCurve = renderPlot({
      ggplot(data.frame(x = CoxBaseline[,1], y = exp(-CoxBaseline[,2])^exp(xbeta)),
             aes(CoxBaseline[,1], exp(-CoxBaseline[,2])^exp(xbeta))) + 
        geom_line(size = 2) + 
        geom_hline(yintercept = c(0.5, 0.75), linetype = "dashed") +
        geom_vline(xintercept = CoxTime, linetype = "dashed") +
        xlim(input$CoxLength) +
        ylim(input$CoxHeight) +
        labs(x = paste("Time to", CoxOutcome, "(months)"), y = "Survival Probability") +
        theme(
          plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
          axis.title = element_text(size = 12),
          axis.text = element_text(size = 12),
          panel.background = element_rect(fill = "white"),
          panel.border = element_blank(),
          axis.line = element_line()
        )
    })
  })
  
  
  
  ###########Weibull Model Survival Probability###########
  observeEvent(input$GenerateWeibullCurve, {
    ####Read in the choice of the outcome, beta, intercept and scale####
    WeibullOutcome = input$OutcomeWeibullCurve
    WeibullMatrix = detectWeibullOutcome(WeibullOutcome)
    
    ###From the Weibull Matrix, the 2:5th elements in the middle are the coefficients
    WeibullBetaMatrix = matrix(WeibullMatrix[2:5], ncol = 1)
    WeibullScale = WeibullMatrix[6]
    WeibullIntercept = WeibullMatrix[1]
    WeibullGamma = 1/WeibullScale
    WeibullBetaStar = -WeibullBetaMatrix/WeibullGamma
    ####Read in the chocie of risk factor and time####
    WeibullX1 = input$X1
    WeibullX2 = input$X2
    WeibullX3 = input$X3
    WeibullX4 = input$X4
    WeibullRiskFactorMatrix = matrix(c(WeibullX1, WeibullX2, WeibullX3, WeibullX4), nrow = 1)
    ####Calculate Components of Survival Probability####
    xbeta = as.numeric(exp(WeibullRiskFactorMatrix%*%WeibullBetaStar))
    Alpha = exp(-WeibullIntercept*WeibullGamma)
    WeibullTime = as.numeric(input$TimeWeibullCurve)
    ####Calculate Survival Probability####
    WeibullSurvivalProbability = exp(-Alpha * WeibullTime^WeibullGamma * xbeta)
    
    ####Output the Weibull result####
    output$WeibullSurvivalProbability = 
      renderText(paste("The survival Probability for the patient who is",
                       RiskFactorReport(WeibullX1, WeibullX2, WeibullX3, WeibullX4), round(100*WeibullSurvivalProbability, 2)))
    
    ####Output the x and y length for Weibull Curve####
    output$WeibullXLen = renderUI({
      sliderInput("WeibullLength", "X-axis Length", min = 0, max = 230, step = 1, value = c(0,230))
    })
    output$WeibullYLen = renderUI({
      sliderInput("WeibullHeight", "Y-axis Length", min = 0, max = 1, step = 0.1, value = c(0,1))
    })
    
    
    ####Create the function to put in ggplot????####
    WBSurvival = function(x){
      exp(-Alpha * x^WeibullGamma * xbeta)
    }
    
    ####Output the Weibull curve####
    output$DescriptionofWeibullCurve = renderText({"This patient has a following estimated survival probability curve:"})
    output$WeibullCurve = renderPlot({
      ggplot(data.frame(x = c(0,230)), aes(x)) + 
        stat_function(fun = WBSurvival, size = 1.5) +
        labs(x = paste("Time to", WeibullOutcome, "(months)"), y = "Survival Probability") +
        xlim(input$WeibullLength) +
        ylim(input$WeibullHeight) +
        geom_hline(yintercept = c(0.5, 0.75), linetype = "dashed") +
        geom_vline(xintercept = WeibullTime, linetype = "dashed") +
        theme(
          plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
          axis.title = element_text(size = 12),
          axis.text = element_text(size = 12),
          panel.background = element_rect(fill = "white"),
          panel.border = element_blank(), 
          axis.line = element_line()
        )
    })
    
  })
  
  ###########Exponential Model Survival Probability##########
  observeEvent(input$GenerateExpCurve, {
    ####Read in user input
    ExpOutcome = input$OutcomeExpCurve
    ExpTime = as.numeric(input$TimeExpCurve)
    
    ####Get Beta Matrix and X matrix for Exponential Model####
    ExpBetaMatrix = matrix(- detectExpOutcome(ExpOutcome), ncol = 1)
    
    ExpX1 = input$x11
    ExpX2 = input$x22
    ExpX3 = input$x33
    ExpX4 = input$x44
    ExpRiskFactorMatrix = matrix(c(1, ExpX1, ExpX2, ExpX3, ExpX4), nrow = 1)
    
    ####Build up components for Exponential survival probability####
    lambda = exp(ExpRiskFactorMatrix %*% ExpBetaMatrix)
    
    ####Survival Probability####
    ExpSurvivalProbability = exp(- lambda * ExpTime)
    
    
    ####Output Survival Probability ####
    output$ExpSurvivalProbability = 
      renderText(paste("The survival Probability for the patient who is",
                       RiskFactorReport(ExpX1, ExpX2, ExpX3, ExpX4), round(100*ExpSurvivalProbability, 2)))
    
    ####Output the x and y length for Weibull Curve####
    output$ExpXLen = renderUI({
      sliderInput("ExpLength", "X-axis Length", min = 0, max = 230, step = 1, value = c(0,230))
    })
    output$ExpYLen = renderUI({
      sliderInput("ExpHeight", "Y-axis Length", min = 0, max = 1, step = 0.1, value = c(0,1))
    })
    
    
    ####Create the function to put in ggplot????####
    ExpSurvival = function(x){
      exp(- lambda * x)
    }
    
    ####Output the curve####
    output$DescriptionofExpCurve = renderText({"This patient has a following estimated survival probability curve:"})
    output$ExpCurve = renderPlot({
      ggplot(data.frame(x = c(0,230)), aes(x)) + 
        stat_function(fun = ExpSurvival, size = 1.5) +
        labs(x = paste("Time to", ExpOutcome, "(months)"), y = "Survival Probability") +
        xlim(input$ExpLength) +
        ylim(input$ExpHeight) +
        geom_hline(yintercept = c(0.5, 0.75), linetype = "dashed") +
        geom_vline(xintercept = ExpTime, linetype = "dashed") +
        theme(
          plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
          axis.title = element_text(size = 12),
          axis.text = element_text(size = 12),
          panel.background = element_rect(fill = "white"),
          panel.border = element_blank(), 
          axis.line = element_line()
        )
    })
    
  })
  
  ###########Log Normal Model Survival Probability##########
  observeEvent(input$GenerateLNCurve, {
    ####Read in user input
    LNOutcome = input$OutcomeLNCurve
    LNTime = as.numeric(input$TimeLNCurve)
    
    ####Get Beta Matrix, X matrix, and alpha for LN Model####
    LNMatrix = detectLogOutcome(LNOutcome)
    
    LNBetaMatrix = matrix(LNMatrix[1:5], ncol = 1)
    SCALE = LNMatrix[6]
    LNBetaStar = LNBetaMatrix/SCALE
    
    LNX1 = input$X11
    LNX2 = input$X22
    LNX3 = input$X33
    LNX4 = input$X44
    LNRiskFactorMatrix = matrix(c(1, LNX1, LNX2, LNX3, LNX4), nrow = 1)
    
    ####Build up components for lOG NORMAL survival probability####
    AlphaLogT = 1/SCALE*log(LNTime)
    xbeta = LNRiskFactorMatrix %*% LNBetaStar
    
    ####Survival Probability####
    LNSurvivalProbability = pnorm(xbeta - AlphaLogT, 0, 1)
    
    
    ####Output Survival Probability ####
    output$LNSurvivalProbability = 
      renderText(paste("The survival Probability for the patient who is",
                       RiskFactorReport(LNX1, LNX2, LNX3, LNX4), round(100*LNSurvivalProbability, 2)))
    
    ####Output the x and y length for Log Normal Curve####
    output$LNXLen = renderUI({
      sliderInput("LNLength", "X-axis Length", min = 0, max = 230, step = 1, value = c(0,230))
    })
    output$LNYLen = renderUI({
      sliderInput("LNHeight", "Y-axis Length", min = 0, max = 1, step = 0.1, value = c(0,1))
    })
    
    
    ####Create the function to put in ggplot????####
    LNSurvival = function(x){
      pnorm(xbeta - 1/SCALE*log(x), 0, 1)
    }
    
    ####Output the curve####
    output$DescriptionofLNCurve = renderText({"This patient has a following estimated survival probability curve:"})
    output$LNCurve = renderPlot({
      ggplot(data.frame(x = c(0,230)), aes(x)) + 
        stat_function(fun = LNSurvival, size = 1.5) +
        labs(x = paste("Time to", LNOutcome, "(months)"), y = "Survival Probability") +
        xlim(input$LNLength) +
        ylim(input$LNHeight) +
        geom_hline(yintercept = c(0.5, 0.75), linetype = "dashed") +
        geom_vline(xintercept = LNTime, linetype = "dashed") +
        theme(
          plot.title = element_text(size = 14, face = "bold", hjust = 0.5),
          axis.title = element_text(size = 12),
          axis.text = element_text(size = 12),
          panel.background = element_rect(fill = "white"),
          panel.border = element_blank(), 
          axis.line = element_line()
        )
    })
    
  })

  
  
}

# Run the application 
shinyApp(ui = ui, server = server)

